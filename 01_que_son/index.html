



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>1. Qué son - Teselas Vectoriales en la IDE</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#concepto-de-tesela-vectorial" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Teselas Vectoriales en la IDE" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Teselas Vectoriales en la IDE
              </span>
              <span class="md-header-nav__topic">
                1. Qué son
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/geomatico/taller-vt-jiide/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Teselas Vectoriales en la IDE" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Teselas Vectoriales en la IDE
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/geomatico/taller-vt-jiide/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        1. Qué son
      </label>
    
    <a href="./" title="1. Qué son" class="md-nav__link md-nav__link--active">
      1. Qué son
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estandares-de-codificacion-de-las-teselas-vectoriales" title="Estándares de codificación de las teselas vectoriales" class="md-nav__link">
    Estándares de codificación de las teselas vectoriales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overzoom" title="Overzoom" class="md-nav__link">
    Overzoom
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codificacion" title="Codificación" class="md-nav__link">
    Codificación
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codificar-geometrias" title="Codificar geometrías" class="md-nav__link">
    Codificar geometrías
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#codificar-atributos" title="Codificar atributos" class="md-nav__link">
    Codificar atributos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winding-order" title="Winding order" class="md-nav__link">
    Winding order
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diferentes-especificaciones-y-conceptos-relacionados-con-las-teselas-vectoriales" title="Diferentes especificaciones y conceptos relacionados con las teselas vectoriales" class="md-nav__link">
    Diferentes especificaciones y conceptos relacionados con las teselas vectoriales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pbf" title="pbf" class="md-nav__link">
    pbf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mvt" title="mvt" class="md-nav__link">
    mvt
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-practico-generando-teselas-vectoriales-con-postgis" title="Caso práctico: Generando teselas vectoriales con PostGIS" class="md-nav__link">
    Caso práctico: Generando teselas vectoriales con PostGIS
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02_crearlas/" title="2. Cómo crearlas" class="md-nav__link">
      2. Cómo crearlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03_servirlas/" title="3. Cómo servirlas" class="md-nav__link">
      3. Cómo servirlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04_OGC/" title="4. Servicios estándar" class="md-nav__link">
      4. Servicios estándar
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../05_sprites_glyphs/" title="5. Iconos y tipografías" class="md-nav__link">
      5. Iconos y tipografías
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../06_estilos/" title="6. Especificación de estilo "Mapbox GL Style spec"" class="md-nav__link">
      6. Especificación de estilo "Mapbox GL Style spec"
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../07_recursos/" title="7. Recursos" class="md-nav__link">
      7. Recursos
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#estandares-de-codificacion-de-las-teselas-vectoriales" title="Estándares de codificación de las teselas vectoriales" class="md-nav__link">
    Estándares de codificación de las teselas vectoriales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overzoom" title="Overzoom" class="md-nav__link">
    Overzoom
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#codificacion" title="Codificación" class="md-nav__link">
    Codificación
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codificar-geometrias" title="Codificar geometrías" class="md-nav__link">
    Codificar geometrías
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#codificar-atributos" title="Codificar atributos" class="md-nav__link">
    Codificar atributos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winding-order" title="Winding order" class="md-nav__link">
    Winding order
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diferentes-especificaciones-y-conceptos-relacionados-con-las-teselas-vectoriales" title="Diferentes especificaciones y conceptos relacionados con las teselas vectoriales" class="md-nav__link">
    Diferentes especificaciones y conceptos relacionados con las teselas vectoriales
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pbf" title="pbf" class="md-nav__link">
    pbf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mvt" title="mvt" class="md-nav__link">
    mvt
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#caso-practico-generando-teselas-vectoriales-con-postgis" title="Caso práctico: Generando teselas vectoriales con PostGIS" class="md-nav__link">
    Caso práctico: Generando teselas vectoriales con PostGIS
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/geomatico/taller-vt-jiide/edit/master/docs/01_que_son.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="concepto-de-tesela-vectorial">Concepto de tesela vectorial</h1>
<div class="admonition tip">
<p class="admonition-title">Presentación</p>
<p>Ver este capítulo en <a href="../presentacion/">formato presentación</a></p>
</div>
<h2 id="estandares-de-codificacion-de-las-teselas-vectoriales">Estándares de codificación de las teselas vectoriales</h2>
<p><img alt="Conversión de " src="../img/etapas.svg" />
Transformación de una capa de datos a una tesela de imagen o tesela vectorial</p>
<table>
<thead>
<tr>
<th>Teselas vectoriales</th>
<th>Teselas de imagen</th>
</tr>
</thead>
<tbody>
<tr>
<td>Estilo se define en el cliente</td>
<td>Estilo se define en el servidor</td>
</tr>
<tr>
<td>Sólo se necesita teselar la información una sola vez y se pueden tener múltiples mapas</td>
<td>Hay que teselas la información para cada mapa</td>
</tr>
<tr>
<td><em>Overzoom</em> se mantiene resolución</td>
<td><em>Overzoom</em> pierde resolución (pixelado)</td>
</tr>
<tr>
<td>Menor tamaño (se recomienda máximo 500kb)</td>
<td>Más fáciles de consumir</td>
</tr>
<tr>
<td>Cache ocupa mucho menos espacio. Fáctible el uso en dispositivos móviles sin conexión</td>
<td>Cache ocupa mucho espacio. Uso en dispositivos móviles requiere mucho espacio de disco</td>
</tr>
<tr>
<td>Acceso nativo a la información del objeto (atributos y geometría), lo que permite un procesamiento muy sofisticado</td>
<td></td>
</tr>
<tr>
<td>Se ven mejor en dispositivos de alta resolución</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="Comparativa pesos teselas vector vs imagen" src="../img/vector-raster.png" />
Comparativa pesos teselas vector vs imagen. Fuente <a href="https://plot.ly/~mourner/118.embed">https://plot.ly/~mourner/118.embed</a></p>
<h3 id="overzoom">Overzoom</h3>
<p><em>Overzooming</em> es una técnica específica de teselas vectorial que permite que una tesela se represente más allá de su nivel de zoom previsto, por lo que continúa siendo visible en el mapa. Si un conjunto de teselas tiene un minzoom de 6 y un maxzoom de 12, esos son los rangos válidos calculados por el generador de teselas. Si ampliara el mapa más allá del nivel de zoom 12, el renderizador del mapa puede seguir utilizando los datos del zoom 12 escalando los datos del vector hacia arriba. Esto, por supuesto, puede dar lugar a grandes simplificaciones de datos si las geometrías se representan demasiado por encima de su nivel real de detalle.</p>
<p>Las teselas imagen pierden claridad si ocurre overzoom. Por ejemplo, si está visualizando un conjunto de teselas imagen con una extensión de zoom entre z0 y z6, si hace un zoom a un nivel de zoom más alto después de z6, las imágenes se volverán borrosas y difíciles de ver.</p>
<p>Los efectos del overzoom no son tan notables con las teselas vector, ya que los datos vectoriales no se almacenan en un formato basado en píxeles, sino que se codifican y calculan a partir de una serie de puntos, líneas y polígonos.</p>
<p><img alt="Overzoom" src="../img/overzoom.png" /></p>
<p>Overzoom nivel zoom 16 vs nivel zoom 19.</p>
<h2 id="codificacion">Codificación</h2>
<p>Las geometrías y los atributos se codifican como datos binarios de Google Protobuf (PBF).</p>
<h3 id="codificar-geometrias">Codificar geometrías</h3>
<p>Para codificar información geográfica en una tesela vectorial, una herramienta debe convertir las coordenadas geográficas, como la latitud y la longitud, en coordenadas vectoriales de cuadrículas. Las teselas de vectoriales no tienen ningún concepto de información geográfica. Codifican puntos, líneas y polígonos como pares x/y relativos a la esquina superior izquierda de la cuadrícula de forma descendente.</p>
<p>Las geometrías son transformadas a una sola tesela, con un sistema de coordenadas de píxel local, que por defecto va de la esquina superior izquierda (0,0) a la esquina inferior derecha (4096,4096).</p>
<p><img alt="Codificar geometría" src="../img/geo2pbf.gif" /></p>
<p>Codificar geometría. Fuente <a href="https://www.mapbox.com/vector-tiles/specification/#encoding-geom">https://www.mapbox.com/vector-tiles/specification/#encoding-geom</a></p>
<h3 id="codificar-atributos">Codificar atributos</h3>
<p>Los atributos se codifican como un conjunto único de claves (algo así como un esquema de campos de capa) y la lista de sus valores.</p>
<p>Los atributos están codificados en una serie de etiquetas que existen dentro de un elemento en el vector que tienen valores enteros que hacen referencia a las claves y los valores que provienen de la geometría. Esto elimina la redundancia de los atributos para geometrías que tienen las mismas claves y valores similares.</p>
<p><img alt="Codificar atributos" src="../img/atributos2pbf.png" /></p>
<p>Codificar atributos. Fuente <a href="https://www.mapbox.com/vector-tiles/specification/#encoding-attr">https://www.mapbox.com/vector-tiles/specification/#encoding-attr</a></p>
<h3 id="winding-order">Winding order</h3>
<p>El <em>Winding order</em> (dirección de digitalización) se refiere a la dirección en que se dibuja un anillo en un mosaico vectorial, ya sea en sentido horario o antihorario. Muchas geometrías son multipolígonos con "agujeros", que también se representan como anillos de polígono. Es importante poder inferir el orden al extraer datos fuente de un mosaico vectorial y comprender si la geometría es parte de un polígono múltiple o un polígono único.</p>
<p>Para que los procesadores distingan de manera apropiada que polígonos son agujeros y cuáles son geometrías únicas, la especificación requiere que todos los polígonos sean válidos (validez de OGC). Cualquier anillo interior poligonal debe orientarse con el orden opuesto al de su anillo exterior principal y todos los anillos interiores deben seguir directamente el anillo exterior al que pertenecen. Los anillos exteriores deben estar orientados en el sentido de las agujas del reloj y los anillos interiores deben estar orientados en sentido contrario a las agujas del reloj.</p>
<p><img alt="Winding order" src="../img/winding-order.png" /></p>
<p>Winding order. Fuente <a href="https://www.mapbox.com/vector-tiles/specification/#winding-order">https://www.mapbox.com/vector-tiles/specification/#winding-order</a></p>
<h2 id="diferentes-especificaciones-y-conceptos-relacionados-con-las-teselas-vectoriales">Diferentes especificaciones y conceptos relacionados con las teselas vectoriales</h2>
<h3 id="pbf">pbf</h3>
<p><strong>Protocol buffers</strong> (pbf) desarrollado por Google (para uso interno) es un método para serializar datos estructurados. Es <em>language-neutral</em>, <em>platform-neutral</em> y en cuyo objetivo de diseño enfatizaron la simplicidad y el rendimiento.</p>
<p>El método implica un lenguaje de descripción de interfaz (<code>.proto</code>) que describe la estructura de algunos datos y un programa que genera código fuente a partir de esa descripción para generar o analizar una secuencia de bytes que representa los datos estructurados.</p>
<h3 id="mvt">mvt</h3>
<p>Formato binario basado en la especificación de Mapbox que usa <strong>pbf</strong> para serializar datos geográficos. Los archivos deberían tener extensión .mvt pero no es obligatorio así que se pueden encontrar archivos con extensión .pbf, .vector.pbf o .mvt.gz (compresión gzip)</p>
<p>Por ejemplo un conjunto de teselas mvt almacenadas en un SQLite siguiendo una esquema específico formaría un MBTiles.</p>
<h2 id="caso-practico-generando-teselas-vectoriales-con-postgis">Caso práctico: Generando teselas vectoriales con PostGIS</h2>
<p>Desde PostGIS 2.4.0 existe la función <code>ST_AsMVT</code> para generar teselas directamente con SQL.</p>
<p>A partir de los recursos de este enlace:</p>
<p><a href="https://github.com/geomatico/taller-vt-jiide/tree/master/ejercicios/01">https://github.com/geomatico/taller-vt-jiide/tree/master/ejercicios/01</a></p>
<ol>
<li>
<p>Cargar la base de datos <code>vt_dump</code>, que contiene los barrios de Barcelona, mediante psql. El comando sería:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>psql -U postgres -W &amp;lt; vt_dump.sql
</pre></div>
</td></tr></table>

</li>
<li>
<p>Conectándonos a la nueva base de datos <code>vt</code>, con usuario <code>vt</code>, y password <code>vt</code>:</p>
<ul>
<li>
<p>Creamos una función auxiliar que calcula el BBOX de una tesela en función de los parámetros (x, y, z):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">FUNCTION</span> <span class="n">BBox</span><span class="p">(</span><span class="n">z</span> <span class="nb">integer</span><span class="p">,</span> <span class="n">x</span> <span class="nb">integer</span><span class="p">,</span> <span class="n">y</span> <span class="nb">integer</span><span class="p">)</span>
    <span class="k">RETURNS</span> <span class="n">geometry</span> <span class="k">AS</span>
<span class="s">$</span><span class="dl">BODY</span><span class="s">$</span>
<span class="k">DECLARE</span>
    <span class="n">max</span> <span class="nb">numeric</span> <span class="o">:=</span> <span class="mf">6378137</span> <span class="o">*</span> <span class="n">pi</span><span class="p">();</span>
    <span class="n">res</span> <span class="nb">numeric</span> <span class="o">:=</span> <span class="n">max</span> <span class="o">*</span> <span class="mf">2</span> <span class="o">/</span> <span class="mf">2</span><span class="o">^</span><span class="n">z</span><span class="p">;</span>
<span class="k">BEGIN</span>
    <span class="k">return</span> <span class="n">ST_MakeEnvelope</span><span class="p">(</span>
        <span class="o">-</span><span class="n">max</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">res</span><span class="p">),</span>
        <span class="n">max</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">res</span><span class="p">),</span>
        <span class="o">-</span><span class="n">max</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span> <span class="o">+</span> <span class="n">res</span><span class="p">,</span>
        <span class="n">max</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="n">res</span><span class="p">)</span> <span class="o">-</span> <span class="n">res</span><span class="p">,</span>
        <span class="mf">3857</span><span class="p">);</span>
<span class="k">END</span><span class="p">;</span>
<span class="s">$</span><span class="dl">BODY</span><span class="s">$</span>
  <span class="k">LANGUAGE</span> <span class="n">plpgsql</span><span class="p">;</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Ejecutamos la consulta que nos devuelve la tesela de zoom=13, x=4145 e y=3059, de la siguiente manera:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">SELECT</span> <span class="n">ST_AsMVT</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="s1">&#39;mvt_barrios&#39;</span><span class="p">)</span>
<span class="k">FROM</span> <span class="p">(</span>
  <span class="k">SELECT</span> <span class="n">gid</span><span class="p">,</span> <span class="n">n_barri</span><span class="p">,</span>
    <span class="n">ST_AsMVTGeom</span><span class="p">(</span>
      <span class="n">geom</span><span class="p">,</span>
      <span class="n">BBox</span><span class="p">(</span><span class="mf">13</span><span class="p">,</span> <span class="mf">4145</span><span class="p">,</span> <span class="mf">3059</span><span class="p">),</span>
      <span class="mf">4096</span><span class="p">,</span>
      <span class="mf">0</span>
    <span class="p">)</span> <span class="k">AS</span> <span class="n">geom</span>
  <span class="k">FROM</span> <span class="n">barrios</span>
  <span class="k">WHERE</span> <span class="n">geom</span> <span class="o">&amp;&amp;</span> <span class="n">BBox</span><span class="p">(</span><span class="mf">13</span><span class="p">,</span> <span class="mf">4145</span><span class="p">,</span> <span class="mf">3059</span><span class="p">)</span>
<span class="p">)</span> <span class="k">AS</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</td></tr></table>

</li>
</ul>
</li>
</ol>
<p>La tesela resultante correspondería a este área de Barcelona:</p>
<p><img alt="Tesela" src="../img/3059.png" /></p>
<p>Obviamente, generar una sola tesela no tiene sentido. Pero ya tenemos la pieza principal para construir un generador de pirámides de teselas,
o construir un servicio web de tipo <code>{z}/{x}/{y}</code>.</p>
<p>Esta capacidad la utilizan múltiples implementaciones como tegola, t-rex, o el generador de teselas de OpenMapTiles, llamado
<a href="https://github.com/openmaptiles/postserve/blob/master/server.py#L27">postserve</a>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="../02_crearlas/" title="2. Cómo crearlas" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                2. Cómo crearlas
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>